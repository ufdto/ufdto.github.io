---
export interface Props {
  title?: string;
  description?: string;
}

const { title = "Pechgr√ºn", description = "" } = Astro.props;
---

<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="author" content="Udo Dengler">
    <meta name="creator" content="Udo Dengler">

    <title>{title}</title>
    {description ? <meta name="description" content={description} /> : null}

    <!-- Optional: Inter (uncomment if you want it) -->
    <!-- <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" /> -->
  </head>

  <body>
    <a class="skip-link" href="#main">Skip to content</a>

    <header class="site-header">
      <div class="header-inner">
        <div class="brand">
          <a href="/" class="brand-link">Pechgr√ºn</a>
        </div>

        <nav class="top-nav" aria-label="Hauptnavigation">
          <a href="/rundgang">Rundgang</a>
          <span class="sep">¬∑</span>

          <a href="/inhalte">Inhalt</a>
          <span class="sep">¬∑</span>

          <a href="/chronik">Entstehung</a>
          <span class="sep">¬∑</span>

          <a href="/quellen">Quellen</a>
          <span class="sep">¬∑</span>

          <a href="/impressum">√úber diese Website</a>

          <!-- Language help flags (EN / CZ) -->
          <span class="sep">¬∑</span>
          <button
            class="lang-flag"
            type="button"
            data-lang="en"
            aria-label="How to translate this website (English)"
            title="How to translate this website"
          >
            üá¨üáß
          </button>
          <button
            class="lang-flag"
            type="button"
            data-lang="cs"
            aria-label="Jak p≈ôelo≈æit tuto webovou str√°nku (ƒåe≈°tina)"
            title="Jak p≈ôelo≈æit tuto webovou str√°nku"
          >
            üá®üáø
          </button>
        </nav>
      </div>
    </header>

    <main id="main" class="main">
      <slot />
    </main>

    <!-- Translation help modal (hidden by default) -->
    <div class="lang-modal" id="langModal" aria-hidden="true">
      <div class="lang-modal__backdrop" data-close="true" aria-hidden="true">
      </div>

      <div
        class="lang-modal__panel"
        role="dialog"
        aria-modal="true"
        aria-labelledby="langModalTitle"
        tabindex="-1"
      >
        <div class="lang-modal__header">
          <h2 class="lang-modal__title" id="langModalTitle"></h2>
          <button
            class="lang-modal__close"
            type="button"
            data-close="true"
            aria-label="Close"
            title="Close"
          >
            √ó
          </button>
        </div>

        <div class="lang-modal__body" id="langModalBody"></div>
      </div>
    </div>

    <script is:inline>
      (function () {
        const modal = document.getElementById("langModal");
        const panel = modal ? modal.querySelector(".lang-modal__panel") : null;
        const titleEl = document.getElementById("langModalTitle");
        const bodyEl = document.getElementById("langModalBody");
        const triggers = document.querySelectorAll(".lang-flag");
        const closeEls = modal
          ? modal.querySelectorAll('[data-close="true"]')
          : [];

        let lastFocus = null;

        const CONTENT = {
          en: {
            title: "Translate this website",
            body: `
              <p><strong>This website is written in German.</strong><br>
              It deals with the history of a German-speaking village.
              If you prefer English, your browser can translate the texts automatically.</p>

              <p><strong>How it usually works:</strong></p>
              <ul>
                <li>Many browsers show an automatic message offering to translate the page.</li>
                <li>If not, right-click on the text and choose ‚ÄúTranslate‚Äù.</li>
              </ul>

              <p><strong>Depending on the browser:</strong></p>
              <ul>
                <li><strong>Chrome / Edge:</strong> Right-click ‚Üí ‚ÄúTranslate‚Äù or use the translate icon in the address bar.</li>
                <li><strong>Safari (Mac, iPhone, iPad):</strong> Click <strong>aA</strong> in the address bar ‚Üí ‚ÄúTranslate Website‚Äù (if available).</li>
                <li><strong>Firefox:</strong> Right-click ‚Üí ‚ÄúTranslate Page‚Äù (depending on settings).</li>
              </ul>

              <p><strong>Note:</strong><br>
              Automatic translations are helpful, but place names, dialect words and historical terms may not always be translated accurately.
              The German original is the reference.</p>
            `,
          },

          cs: {
            title: "P≈ôeklad t√©to webov√© str√°nky",
            body: `
              <p><strong>Tato webov√° str√°nka je naps√°na v nƒõmƒçinƒõ.</strong><br>
              Zab√Ωv√° se histori√≠ nƒõmecky mluv√≠c√≠ obce.
              Pokud d√°v√°≈° p≈ôednost ƒçe≈°tinƒõ, m≈Ø≈æe tv≈Øj prohl√≠≈æeƒç texty automaticky p≈ôelo≈æit.</p>

              <p><strong>Jak to obvykle funguje:</strong></p>
              <ul>
                <li>Mnoho prohl√≠≈æeƒç≈Ø automaticky nab√≠dne p≈ôeklad str√°nky.</li>
                <li>Pokud ne, klikni prav√Ωm tlaƒç√≠tkem my≈°i na text a zvol ‚ÄûP≈ôelo≈æit‚Äú.</li>
              </ul>

              <p><strong>Podle typu prohl√≠≈æeƒçe:</strong></p>
              <ul>
                <li><strong>Chrome / Edge:</strong> Prav√Ωm tlaƒç√≠tkem ‚Üí ‚ÄûP≈ôelo≈æit‚Äú nebo ikona p≈ôekladu v adresn√≠m ≈ô√°dku.</li>
                <li><strong>Safari (Mac, iPhone, iPad):</strong> V adresn√≠m ≈ô√°dku klikni na <strong>aA</strong> ‚Üí ‚ÄûP≈ôelo≈æit web‚Äú (pokud je k dispozici).</li>
                <li><strong>Firefox:</strong> Prav√Ωm tlaƒç√≠tkem ‚Üí ‚ÄûP≈ôelo≈æit str√°nku‚Äú (dle nastaven√≠).</li>
              </ul>

              <p><strong>Pozn√°mka:</strong><br>
              Automatick√Ω p≈ôeklad pom√°h√° porozumƒõn√≠, ale n√°zvy m√≠st, n√°≈ôeƒçn√≠ v√Ωrazy a historick√© pojmy nemus√≠ b√Ωt v≈ædy p≈ôelo≈æeny p≈ôesnƒõ.
              Nƒõmeck√Ω origin√°l je v√Ωchoz√≠ verz√≠ t√©to str√°nky.</p>
            `,
          },
        };

        function openModal(lang) {
          if (!modal || !panel || !titleEl || !bodyEl) return;

          const data = CONTENT[lang] || CONTENT.en;

          titleEl.textContent = data.title;
          bodyEl.innerHTML = data.body;

          lastFocus = document.activeElement;

          modal.classList.add("is-open");
          modal.setAttribute("aria-hidden", "false");

          // Focus dialog for accessibility
          panel.focus();

          // Prevent background scrolling
          document.documentElement.classList.add("no-scroll");
          document.body.classList.add("no-scroll");
        }

        function closeModal() {
          if (!modal) return;

          modal.classList.remove("is-open");
          modal.setAttribute("aria-hidden", "true");

          document.documentElement.classList.remove("no-scroll");
          document.body.classList.remove("no-scroll");

          if (lastFocus && typeof lastFocus.focus === "function") {
            lastFocus.focus();
          }
        }

        // Open on flag click
        triggers.forEach((btn) => {
          btn.addEventListener("click", () => {
            const lang = btn.getAttribute("data-lang") || "en";
            openModal(lang);
          });
        });

        // Close buttons + backdrop
        closeEls.forEach((el) => {
          el.addEventListener("click", closeModal);
        });

        // Click outside panel closes (but clicks inside panel do not)
        if (modal && panel) {
          modal.addEventListener("click", (e) => {
            if (e.target === modal) closeModal();
          });
          panel.addEventListener("click", (e) => e.stopPropagation());
        }

        // ESC closes
        document.addEventListener("keydown", (e) => {
          if (
            e.key === "Escape" &&
            modal &&
            modal.classList.contains("is-open")
          ) {
            closeModal();
          }
        });
      })();
    </script>

    <style>
      /* ---------- Base reset ---------- */
      :global(*) {
        box-sizing: border-box;
      }
      :global(html, body) {
        margin: 0;
        padding: 0;
      }
      :global(img) {
        max-width: 100%;
        height: auto;
      }

      /* ---------- Typography ---------- */
      :global(body) {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        line-height: 1.6;
        color: #111;
        background: #fff;
      }

      :global(a) {
        color: inherit;
      }
      :global(a:hover) {
        text-decoration: underline;
      }

      /* Narrow figures (e.g., Redelbach images): max 540px, left-aligned */
      :global(main figure.narrow) {
        max-width: 540px;
        margin: 1.25rem 0 2rem;
      }

      :global(main figure.narrow img) {
        width: 100%;
        height: auto;
      }

      :global(main figure img) {
        display: block;
        width: 100%;
        height: auto;
      }

      /* ---------- Layout ---------- */
      .site-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        border-bottom: 1px solid rgba(0, 0, 0, 0.12);
        background: #fff;
      }

      .site-header {
        backdrop-filter: blur(8px);
        background: rgba(255, 255, 255, 0.92);
      }

      .header-inner {
        max-width: 980px;
        margin: 0 auto;
        padding: 0.9rem 1.25rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .brand-link {
        text-decoration: none;
        font-weight: 600;
      }

      .top-nav {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        white-space: nowrap;
      }

      .top-nav a {
        text-decoration: none;
        opacity: 0.9;
      }

      .top-nav a:hover {
        opacity: 1;
      }

      .sep {
        opacity: 0.45;
      }

      .main {
        max-width: 980px;
        margin: 0 auto;
        padding: 1.75rem 1.25rem 3rem;
      }

      /* ---------- Content defaults ---------- */
      :global(main h1) {
        font-size: 2.5rem;
        line-height: 1.15;
        margin: 0 0 1rem;
      }

      :global(main h2) {
        margin-top: 2rem;
        margin-bottom: 0.75rem;
        line-height: 1.2;
      }

      :global(main p) {
        margin: 0 0 1rem;
      }

      :global(main figure) {
        margin: 1.25rem 0 2rem;
      }

      :global(main figcaption) {
        margin-top: 0.6rem;
        font-size: 0.95rem;
        opacity: 0.85;
        line-height: 1.4;
      }

      :global(main blockquote) {
        margin: 1rem 0 1.5rem;
        padding: 1rem 1.25rem;
        border-left: 4px solid rgba(0, 0, 0, 0.15);
      }

      :global(main blockquote p) {
        margin: 0.5rem 0;
      }

      /* Accessibility */
      .skip-link {
        position: absolute;
        left: -9999px;
        top: 0;
      }
      .skip-link:focus {
        left: 1rem;
        top: 1rem;
        background: #fff;
        border: 1px solid rgba(0, 0, 0, 0.2);
        padding: 0.5rem 0.75rem;
        border-radius: 8px;
      }

      /* Responsive header wrap */
      @media (max-width: 520px) {
        .header-inner {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      /* Panorama viewport: show it taller, allow horizontal scroll */
      :global(.pano-viewport) {
        width: 100%;
        height: 540px;
        overflow-x: auto;
        overflow-y: hidden;
        border-radius: 12px;
        -webkit-overflow-scrolling: touch;
        background: rgba(0, 0, 0, 0.03);
      }

      :global(.pano-viewport .pano-img) {
        height: 100%;
        width: auto !important;
        max-width: none !important;
        object-fit: contain;
        display: block;
      }
    </style>

    <!-- IMPORTANT: UI styles must be global so Astro scoping can't break them -->
    <style is:global>
      /* Flag buttons ‚Äì no frame, larger, subtle hover */
      .lang-flag {
        appearance: none;
        -webkit-appearance: none;
        border: 0 !important;
        background: transparent !important;
        padding: 0rem 0rem;
        margin: 0;
        cursor: pointer;
        font-size: 1.35rem;
        line-height: 1;
        opacity: 0.9;
        transform: translateY(1px);
      }
      .lang-flag:hover {
        opacity: 1;
        filter: saturate(1.05);
      }
      .lang-flag:focus-visible {
        outline: 2px solid rgba(0, 0, 0, 0.35);
        outline-offset: 2px;
        border-radius: 8px;
      }

      /* Prevent background scroll when modal open */
      html.no-scroll,
      body.no-scroll {
        overflow: hidden !important;
      }

      /* Modal overlay */
      .lang-modal {
        position: fixed;
        inset: 0;
        z-index: 2000;
        display: none;
      }
      .lang-modal.is-open {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 7vh 1rem 2rem;
      }

      .lang-modal__backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.35);
      }

      .lang-modal__panel {
        position: relative;
        width: min(760px, 100%);
        background: #fff;
        border-radius: 14px;
        box-shadow: 0 18px 60px rgba(0, 0, 0, 0.25);
        padding: 1rem 1.15rem 1.1rem;
        z-index: 1;
      }

      .lang-modal__header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 0.25rem;
      }

      /* Title: intentionally larger so it reads like a page title */
      .lang-modal__title {
        font-size: 2.5rem;
        line-height: 1.12;
        font-weight: 700;
        margin: 0 0 0.6rem 0;
      }

      .lang-modal__close {
        appearance: none;
        -webkit-appearance: none;
        border: 0;
        background: transparent;
        cursor: pointer;
        font-size: 1.6rem;
        line-height: 1;
        padding: 0.1rem 0.35rem;
        opacity: 0.7;
      }
      .lang-modal__close:hover {
        opacity: 1;
      }
      .lang-modal__close:focus-visible {
        outline: 2px solid rgba(0, 0, 0, 0.35);
        outline-offset: 2px;
        border-radius: 10px;
      }

      /* Rhythm in modal content: calmer, more structured */
      .lang-modal__body p {
        margin: 0 0 0.6rem;
      }

      /* Pull list closer to its preceding label paragraph */
      .lang-modal__body p + ul {
        margin-top: -0.25rem;
      }

      .lang-modal__body ul {
        margin: 0 0 0.9rem 1.15rem;
        padding: 0;
      }

      .lang-modal__body li {
        margin: 0.2rem 0;
      }

      /* √úberschrift (p) + Liste im Modal enger zusammenziehen */
      .lang-modal__body p + ul {
        margin-top: -0.35rem;
      }
    </style>
  </body>
</html>
