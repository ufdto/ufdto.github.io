---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const landschaften = await getCollection("landschaft");

const items = [
  ...landschaften.map((e) => ({
    title: e.data.title,
    subtitle: e.data.subtitle ?? "",
    tags: (e.data.tags ?? []).join(" "),
    href: `/landschaft/${e.slug}`,
    kind: "Landschaft",
  })),
];
---

<BaseLayout title="Suche">
  <h1>Suche</h1>
  <p class="lede">Suche über Titel, Untertitel und Tags (vorläufig).</p>

  <input
    id="q"
    type="search"
    placeholder="Suche …"
    autocomplete="off"
    class="search-input"
  />

  <ul id="results" class="results">
    {items.map((it) => (
      <li
        class="result-item"
        data-text={`${it.title} ${it.subtitle} ${it.tags} ${it.kind}`.toLowerCase()}
      >
        <a href={it.href} class="result-link">{it.title}</a>
        <span class="meta"> · {it.kind}</span>
        {it.subtitle ? <span class="meta"> — {it.subtitle}</span> : null}
      </li>
    ))}
  </ul>

  <script type="module">
    const input = document.getElementById("q");
    const list = document.getElementById("results");

    if (input instanceof HTMLInputElement && list instanceof HTMLUListElement) {
      const rows = Array.from(list.querySelectorAll("li"));

      input.addEventListener("input", () => {
        const q = input.value.trim().toLowerCase();
        for (const li of rows) {
          const text = li.dataset.text ?? "";
          li.style.display = !q || text.includes(q) ? "" : "none";
        }
      });
    }
  </script>
</BaseLayout>

<style>
  .lede {
    margin-top: 10px;
    color: rgba(0, 0, 0, 0.65);
  }

  .search-input {
    width: 100%;
    margin-top: 18px;
    padding: 10px 12px;
    font-size: 1rem;
    border: 1px solid rgba(0, 0, 0, 0.25);
    border-radius: 6px;
  }

  .results {
    margin: 18px 0 0;
    padding-left: 18px;
  }

  .result-item {
    margin: 8px 0;
  }

  .result-link {
    text-decoration: none;
  }

  .result-link:hover {
    text-decoration: underline;
  }

  .meta {
    color: rgba(0, 0, 0, 0.65);
    font-size: 0.95em;
  }
</style>
